<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Animal Protein and GDP Narrative Visualization</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    button {
      margin-right: 10px;
      padding: 8px 15px;
    }
    svg {
      border: 1px solid #ccc;
    }
    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #999;
      padding: 5px;
      font-size: 12px;
      pointer-events: none;
    }
    .scene-description {
      margin: 10px 0;
      font-style: italic;
    }
  </style>
</head>
<body>

<h1>Animal Protein Consumption vs GDP per Capita (2022)</h1>

<div id="scene1-desc" class="scene-description">
  This scene shows the animal protein consumption vs GDP per capita in 2022 for all countries, giving an insight into how much animal protein people consume within their country and their economic status.
</div>
<div id="scene2-desc" class="scene-description" style="display:none">
  This scene dived deeper into the relationship of animal protein consumption vs GDP per capita in 2022 for all countries, by specifically showing the animal protein consumption of countries with higher economic wealth per person (GDP > 30k).
</div>
<div id="scene3-desc" class="scene-description" style="display:none">
  This scene dived deeper into the relationship of animal protein consumption vs GDP per capita in 2022 for all countries, by specifically showing the animal protein consumption of countries with lower economic wealth per person (GDP < 5k).
</div>

<div>
  <button id="btn1">Scene 1: Global View</button>
  <button id="btn2">Scene 2: High-Income Highlight</button>
  <button id="btn3">Scene 3: Low-Income Highlight</button>
</div>

<svg width="800" height="600"></svg>

<div class="tooltip" style="opacity: 0;"></div>

<script>
d3.csv("data416.csv", function(d) {
  d['GDP per capita, PPP (constant 2017 international $)'] = +d['GDP per capita, PPP (constant 2017 international $)'];
  d['Daily supply of calories from animal products (FAO (2022))'] = +d['Daily supply of calories from animal products (FAO (2022))'];
  return d;
}).then(function(data) {
  data = data.filter(d => d.Year === "2022");

  var svg = d3.select("svg");
  var width = +svg.attr("width") - 100;
  var height = +svg.attr("height") - 100;

  var x = d3.scaleLog()
    .domain([100, d3.max(data, d => d['GDP per capita, PPP (constant 2017 international $)'])])
    .range([0, width]);

  var y = d3.scaleLinear()
    .domain([0, d3.max(data, d => d['Daily supply of calories from animal products (FAO (2022))'])])
    .range([height, 0]);

  var color = d3.scaleOrdinal(d3.schemeCategory10);

  var g = svg.append("g").attr("transform", "translate(50,50)");

  g.append("g")
    .attr("transform", `translate(0,${height})`)
    .call(d3.axisBottom(x).ticks(10, "~s"));

  g.append("g")
    .call(d3.axisLeft(y));

  var tooltip = d3.select(".tooltip");

  var circles = g.selectAll("circle")
    .data(data)
    .enter()
    .append("circle")
    .attr("cx", d => x(d['GDP per capita, PPP (constant 2017 international $)']))
    .attr("cy", d => y(d['Daily supply of calories from animal products (FAO (2022))']))
    .attr("r", 5)
    .attr("fill", d => color(d.Continent))
    .on("mouseover", function(event, d) {
      tooltip.transition().duration(200).style("opacity", .9);
      tooltip.html(
        "Continent: " + d.Continent + "<br/>" +
        "GDP per Capita: $" + Math.round(d['GDP per capita, PPP (constant 2017 international $)']) + "<br/>" +
        "Animal Protein (%): " + d['Daily supply of calories from animal products (FAO (2022))']
      )
      .style("left", (event.pageX + 10) + "px")
      .style("top", (event.pageY - 28) + "px");
    })
    .on("mouseout", function() {
      tooltip.transition().duration(500).style("opacity", 0);
    });

  function updateScene(scene) {
    let filtered;
    if (scene === 1) {
      filtered = data;
    } else if (scene === 2) {
      filtered = data.filter(d => d['GDP per capita, PPP (constant 2017 international $)'] > 30000);
    } else if (scene === 3) {
      filtered = data.filter(d => d['GDP per capita, PPP (constant 2017 international $)'] < 5000);
    }

    circles.data(filtered, d => d.Entity)
      .join(
        enter => enter.append("circle")
                      .attr("cx", d => x(d['GDP per capita, PPP (constant 2017 international $)']))
                      .attr("cy", d => y(d['Daily supply of calories from animal products (FAO (2022))']))
                      .attr("r", 5)
                      .attr("fill", d => color(d.Continent))
                      .on("mouseover", function(event, d) {
                        tooltip.transition().duration(200).style("opacity", .9);
                        tooltip.html(
                          "Continent: " + d.Continent + "<br/>" +
                          "GDP per Capita: $" + Math.round(d['GDP per capita, PPP (constant 2017 international $)']) + "<br/>" +
                          "Animal Protein (%): " + d['Daily supply of calories from animal products (FAO (2022))']
                        )
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                      })
                      .on("mouseout", function() {
                        tooltip.transition().duration(500).style("opacity", 0);
                      }),
        update => update
                      .transition().duration(750)
                      .attr("cx", d => x(d['GDP per capita, PPP (constant 2017 international $)']))
                      .attr("cy", d => y(d['Daily supply of calories from animal products (FAO (2022))'])),
        exit => exit.remove()
      );

    d3.select("#scene1-desc").style("display", scene === 1 ? "block" : "none");
    d3.select("#scene2-desc").style("display", scene === 2 ? "block" : "none");
    d3.select("#scene3-desc").style("display", scene === 3 ? "block" : "none");
  }

  d3.select("#btn1").on("click", () => updateScene(1));
  d3.select("#btn2").on("click", () => updateScene(2));
  d3.select("#btn3").on("click", () => updateScene(3));
});
</script>

</body>
</html>
