<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Animal Protein vs GDP per Capita (2022)</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    svg {
      display: block;
      margin-top: 20px;
    }
    button {
      margin-right: 10px;
      padding: 6px 12px;
      cursor: pointer;
      border: 1px solid #aaa;
      border-radius: 3px;
      background-color: white;
    }
    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #aaa;
      border-radius: 5px;
      padding: 8px;
      font-size: 13px;
      pointer-events: none;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      opacity: 0;
    }
    .scene-description {
      margin: 10px 0;
      font-size: 14px;
    }
  </style>
</head>
<body>

<h1>Animal Protein Consumption vs GDP per Capita (2022)</h1>

<div>
  <p class="scene-description" id="desc-all">
    This scene shows the animal protein consumption vs GDP per capita in 2022 for all countries, giving an insight into how much animal protein people consume within their country and their economic status.
  </p>
  <p class="scene-description" id="desc-high" style="display: none;">
    This scene dives deeper into the relationship of animal protein consumption vs GDP per capita in 2022 for all countries, by specifically showing the animal protein consumption of countries with higher economic wealth per person (GDP > 30k).
  </p>
  <p class="scene-description" id="desc-low" style="display: none;">
    This scene dives deeper into the relationship of animal protein consumption vs GDP per capita in 2022 for all countries, by specifically showing the animal protein consumption of countries with lower economic wealth per person (GDP < 5k).
  </p>

  <button id="btn-all">All Countries</button>
  <button id="btn-high">High Income (GDP &gt; 30k)</button>
  <button id="btn-low">Low Income (GDP &lt; 5k)</button>
</div>

<svg width="800" height="600"></svg>
<div class="tooltip" id="tooltip"></div>

<script>
  var csvUrl = "data416.csv";

  var margin = { top: 50, right: 160, bottom: 60, left: 80 };
  var width = 800 - margin.left - margin.right;
  var height = 600 - margin.top - margin.bottom;

  var svg = d3.select("svg");
  var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
  var tooltip = d3.select("#tooltip");

  var xAxisGroup = g.append("g").attr("transform", "translate(0," + height + ")");
  var yAxisGroup = g.append("g");

  g.append("text")
    .attr("x", width / 2)
    .attr("y", height + 45)
    .attr("text-anchor", "middle")
    .text("GDP per Capita");

  g.append("text")
    .attr("transform", "rotate(-90)")
    .attr("x", -height / 2)
    .attr("y", -50)
    .attr("text-anchor", "middle")
    .text("Share of Daily Calories from Animal Protein (%)");

  var legendGroup = svg.append("g")
    .attr("transform", "translate(" + (width + margin.left + 20) + "," + margin.top + ")");

  d3.csv(csvUrl, function(d) {
    d.gdp = +d["GDP per capita"];
    d.animalProtein = +d["Share of the daily calorie supply that comes from animal protein"];
    d.country = d.Entity;
    d.region = d["World regions according to OWID"];
    d.Code = d.Code; // Country abbreviation
    return d;
  }).then(function(data) {
    data = data.filter(d => d.gdp > 0 && d.animalProtein >= 0);

    var regions = Array.from(new Set(data.map(d => d.region)));
    colorScale.domain(regions);

    var xScale = d3.scaleLinear()
      .domain([0, d3.max(data, d => d.gdp)])
      .range([0, width]);

    var yScale = d3.scaleLinear()
      .domain([0, d3.max(data, d => d.animalProtein)])
      .range([height, 0]);

    xAxisGroup.call(d3.axisBottom(xScale).ticks(10));
    yAxisGroup.call(d3.axisLeft(yScale).ticks(6));

    var legend = legendGroup.selectAll("g")
      .data(regions)
      .enter()
      .append("g")
      .attr("transform", (d, i) => "translate(0," + i * 22 + ")");

    legend.append("rect")
      .attr("width", 18)
      .attr("height", 18)
      .attr("fill", d => colorScale(d));

    legend.append("text")
      .attr("x", 24)
      .attr("y", 14)
      .text(d => d);

    function drawScatter(filteredData) {
      var circles = g.selectAll("circle")
        .data(filteredData, d => d.country);

      circles.exit().remove();

      circles
        .attr("cx", d => xScale(d.gdp))
        .attr("cy", d => yScale(d.animalProtein))
        .attr("fill", d => colorScale(d.region));

      circles.enter()
        .append("circle")
        .attr("cx", d => xScale(d.gdp))
        .attr("cy", d => yScale(d.animalProtein))
        .attr("r", 6)
        .attr("fill", d => colorScale(d.region))
        .attr("stroke", "black")
        .attr("stroke-width", 0.7)
        .on("mouseover", function(event, d) {
          tooltip.transition().duration(150).style("opacity", 1);
          tooltip.html(
              "<strong>Country:</strong> " + d.Code + "<br/>" +
              "<strong>GDP:</strong> $" + d3.format(",")(d.gdp) + "<br/>" +
              "<strong>Animal Protein:</strong> " + d.animalProtein + "%"
            )
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 40) + "px");
        })
        .on("mousemove", function(event) {
          tooltip
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 40) + "px");
        })
        .on("mouseout", function() {
          tooltip.transition().duration(150).style("opacity", 0);
        });
    }

    function updateScene(scene) {
      d3.select("#desc-all").style("display", scene === "all" ? "block" : "none");
      d3.select("#desc-high").style("display", scene === "high" ? "block" : "none");
      d3.select("#desc-low").style("display", scene === "low" ? "block" : "none");
    }

    drawScatter(data);
    updateScene("all");

    d3.select("#btn-all").on("click", function() {
      drawScatter(data);
      updateScene("all");
    });

    d3.select("#btn-high").on("click", function() {
      drawScatter(data.filter(d => d.gdp > 30000));
      updateScene("high");
    });

    d3.select("#btn-low").on("click", function() {
      drawScatter(data.filter(d => d.gdp < 5000));
      updateScene("low");
    });
  });
</script>

</body>
</html>